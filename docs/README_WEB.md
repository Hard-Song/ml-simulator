# ML Simulator Web 应用

一个基于 Flask 的交互式机器学习结果模拟工具，支持多模型对比、学习曲线分析和难度扫描。

## 功能特性

### 1. 多模型对比（主页）
- 实时调整任务参数（样本量、难度等）
- 选择多个模型进行对比
- 可视化展示结果（表格、柱状图、雷达图）
- 导出 CSV 数据

### 2. 学习曲线（开发中）
- 模拟不同数据规模下的模型性能
- 对比多个模型的学习效率
- 可视化学习曲线

### 3. 难度扫描（开发中）
- 扫描难度参数对性能的影响
- 分析模型鲁棒性
- 交互式参数调节

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 启动服务器

```bash
python app.py
```

### 3. 访问应用

打开浏览器访问：
- **主页（多模型对比）**: http://localhost:8080/

## 使用指南

### 多模型对比

#### 步骤 1: 配置任务参数

**左侧参数面板：**

1. **任务类型**
   - 二分类：两个类别的分类任务
   - 多分类：多个类别的分类任务
   - 回归：连续值预测任务

2. **样本量**
   - 拖动滑块调整样本数量（1000 - 20000）
   - 更大的样本量通常带来更稳定的结果

3. **类别设置**（分类任务）
   - 类别数：多分类任务的类别数量
   - 类别分布：逗号分隔的比例（如 `0.7, 0.3`）
   - 留空表示均衡分布

#### 步骤 2: 调整学习难度

**难度参数：**

1. **类间可分性**（0 - 1）
   - 越高：正负类越容易区分 → AUC 越高
   - 越低：类别重叠越多 → 分类越困难

2. **标签噪声**（0 - 0.5）
   - 标签错误的样本比例
   - 越高：模型上限越低

3. **特征噪声**（0 - 0.5）
   - 输入特征的噪声水平
   - 越高：模型置信度越不稳定

4. **非线性强度**（0 - 1）
   - 任务的非线性程度
   - 线性模型（如逻辑回归）对此敏感

#### 步骤 3: 选择模型

勾选要对比的模型：
- **传统模型**：`svm`, `rf`, `logreg`, `nb`, `dt`
- **集成模型**：`lgbm`, `xgboost`, `catboost`
- **深度模型**：`dnn`, `cnn`, `rnn`, `transformer`

#### 步骤 4: 运行模拟

点击 **"运行模拟"** 按钮，等待结果：

- **结果表格**：展示各模型的详细指标
- **准确率对比**：柱状图
- **AUC 对比**：柱状图
- **综合性能**：雷达图（多维度对比）

#### 步骤 5: 导出数据

点击 **"导出 CSV"** 按钮下载结果数据。

## API 文档

### POST /api/simulate

执行单次模拟并返回多模型对比结果。

**请求体：**
```json
{
  "task_type": "binary",
  "num_samples": 5000,
  "n_classes": 2,
  "label_distribution": null,
  "models": ["lgbm", "rf", "logreg"],
  "difficulty": {
    "separability": 0.7,
    "label_noise": 0.05,
    "feature_noise": 0.1,
    "nonlinearity": 0.3,
    "spurious_correlation": 0.3
  },
  "random_state": 42
}
```

**响应：**
```json
{
  "success": true,
  "results": [
    {
      "model": "lgbm",
      "n_classes": 2,
      "accuracy": 0.752,
      "auc": 0.832,
      "precision": 0.761,
      "recall": 0.743,
      "f1": 0.752
    },
    ...
  ]
}
```

### GET /api/models

获取所有可用模型及其能力画像。

**响应：**
```json
{
  "success": true,
  "models": {
    "lgbm": {
      "bias": 0.3,
      "variance": 0.3,
      "capacity": 0.8,
      "noise_tolerance": 0.6
    },
    ...
  }
}
```

## 常见场景示例

### 场景 1: 对比集成模型与传统模型

**配置：**
- 任务类型：二分类
- 样本量：5000
- 可分性：0.6
- 标签噪声：0.05
- 选择模型：`logreg`, `rf`, `lgbm`, `xgboost`

**预期结果：**
- 集成模型（LGBM, XGBoost）表现最佳
- 随机森林次之
- 逻辑回归最低（特别是在高非线性时）

### 场景 2: 模拟不均衡数据

**配置：**
- 任务类型：二分类
- 类别分布：`0.9, 0.1`（90% 负类，10% 正类）
- 可分性：0.7
- 标签噪声：0.1

**预期结果：**
- 所有模型的准确率都较高（因为负类占主导）
- 但 Recall 可能较低（正类识别困难）
- AUC 比 Accuracy 更能反映真实性能

### 场景 3: 高难度任务

**配置：**
- 可分性：0.3（低）
- 标签噪声：0.2（高）
- 特征噪声：0.3（高）
- 非线性：0.8（高）

**预期结果：**
- 所有模型性能下降
- 高方差模型（DNN, Transformer）更不稳定
- 鲁棒模型（RF）相对更好

## 技术架构

```
┌─────────────────────────────────────┐
│         Browser (Frontend)          │
│  HTML + CSS + JavaScript + Chart.js │
└──────────────┬──────────────────────┘
               │ HTTP/REST API
               │
┌──────────────▼──────────────────────┐
│      Flask Server (Backend)         │
│         app.py                      │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│      ML Simulator Core              │
│      ml_simulator.py                │
└─────────────────────────────────────┘
```

## 项目结构

```
mlplot/
├── app.py                    # Flask 应用
├── ml_simulator.py           # 核心模拟引擎
├── requirements.txt          # 依赖
│
├── templates/                # HTML 模板
│   ├── index.html           # 主页（多模型对比）
│   ├── learning_curve.html  # 学习曲线
│   └── difficulty_scan.html # 难度扫描
│
└── static/                   # 静态资源
    ├── css/
    │   └── style.css        # 自定义样式
    └── js/
        └── index.js         # 主页交互逻辑
```

## 开发计划

- [ ] 完成学习曲线页面
- [ ] 完成难度扫描页面
- [ ] 添加更多可视化选项（ROC曲线、PR曲线）
- [ ] 支持保存和加载配置
- [ ] 添加结果对比历史功能

## 故障排查

### 问题：端口已被占用

**错误信息：** `Address already in use`

**解决方法：**
```bash
# 方法1: 使用其他端口
python app.py  # 默认5000，修改 app.py 最后一行的 port

# 方法2: 杀死占用进程
# Windows:
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# Linux/Mac:
lsof -ti:5000 | xargs kill -9
```

### 问题：模块未找到

**错误信息：** `ModuleNotFoundError: No module named 'flask'`

**解决方法：**
```bash
pip install -r requirements.txt
```

### 问题：页面显示异常

**解决方法：**
1. 清除浏览器缓存
2. 检查浏览器控制台错误（F12）
3. 确保静态文件路径正确

## 许可

MIT License
