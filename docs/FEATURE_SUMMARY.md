# 模型能力画像调整功能 - 更新总结

## 新增功能

✅ **自定义模型画像**：用户可以为所有选中的模型设置统一的能力参数

## 更新内容

### 前端更新

**templates/index.html**
- 新增"模型能力调整"区域
- 添加开关控制（启用/禁用自定义）
- 4个能力参数滑块：
  - 偏差 (Bias): 0-1
  - 方差 (Variance): 0-1
  - 表达能力 (Capacity): 0-1
  - 噪声容忍度 (Noise Tolerance): 0-1

**static/js/index.js**
- 绑定新的滑块事件
- 处理自定义画像开关
- 在请求数据中添加 `custom_profile` 字段

### 后端更新

**app.py**
- `/api/simulate` 接口支持 `custom_profile` 参数
- 自动创建自定义 ModelProfile 对象
- 将自定义画像传递给模拟函数

**ml_simulator.py**
- `compare_models()` 函数新增 `custom_profiles` 参数
- 支持传入字典形式的自定义画像
- 优先使用自定义画像，回退到预定义画像

## 使用方法

### 方法 1: 使用预定义画像（默认）

1. 不开启"启用自定义"开关
2. 直接选择模型并运行
3. 每个模型使用其预定义的能力参数

### 方法 2: 使用自定义画像

1. 打开"启用自定义"开关
2. 调整4个能力参数滑块
3. 选择模型（可以选多个）
4. 点击"运行模拟"
5. 所有选中的模型使用相同的自定义画像

## 测试结果

测试脚本 `test_custom_profile.py` 验证：

```
[测试 1] 使用自定义画像
自定义参数: bias=0.2, variance=0.7, capacity=0.9

结果（自定义画像）:
model  accuracy     auc
 lgbm    0.6646 0.72937
   rf    0.6646 0.72937  ← 两个模型结果相同

[测试 2] 使用预定义画像

结果（预定义画像）:
model  accuracy      auc
 lgbm    0.7216 0.845943
   rf    0.6850 0.773498  ← 两个模型结果不同

[成功] 自定义画像生效！准确率最大差异: 0.0570
```

## 典型应用场景

### 1. 理解参数影响
- 固定其他参数，调整一个参数（如 Variance）
- 观察性能变化，理解过拟合

### 2. 对比极端情况
- 保守型（低方差）vs 激进型（高方差）
- 线性（高偏差）vs 非线性（低偏差）

### 3. 适配数据特征
- 高噪声数据 → 提高 Noise Tolerance
- 复杂任务 → 提高 Capacity，降低 Bias

### 4. 模型选择指导
- 小样本 → 选择低方差画像
- 大样本 + 高质量 → 选择高容量画像

## 参数说明

### Bias（偏差）
- **低 (0.1-0.3)**: DNN, Transformer
  - 优点：灵活，能学习复杂模式
  - 缺点：可能过拟合

- **中 (0.4-0.6)**: SVM, RF
  - 平衡偏差和方差

- **高 (0.7-0.9)**: 简单模型
  - 优点：稳定
  - 缺点：可能欠拟合

### Variance（方差）
- **低 (0.1-0.3)**: Logistic Regression
  - 预测稳定，不易过拟合

- **中 (0.4-0.6)**: RF, XGBoost
  - 适度波动

- **高 (0.7-0.9)**: DNN, Transformer
  - 预测不稳定，容易过拟合

### Capacity（表达能力）
- **低 (0.5-0.6)**: 线性模型上限
- **中 (0.7-0.8)**: 集成模型
- **高 (0.9-0.98)**: 深度模型

### Noise Tolerance（噪声容忍度）
- **低 (0.3-0.4)**: SVM（敏感）
- **中 (0.5-0.6)**: LGBM, DNN
- **高 (0.7-0.8)**: RF（鲁棒）

## 推荐参数组合

### 场景 1: 小样本 + 高噪声
```json
{
  "bias": 0.4,
  "variance": 0.2,
  "capacity": 0.6,
  "noise_tolerance": 0.8
}
```

### 场景 2: 大样本 + 高质量
```json
{
  "bias": 0.2,
  "variance": 0.5,
  "capacity": 0.9,
  "noise_tolerance": 0.5
}
```

### 场景 3: 高非线性任务
```json
{
  "bias": 0.2,
  "variance": 0.4,
  "capacity": 0.85,
  "noise_tolerance": 0.6
}
```

## 文件清单

更新的文件：
- `templates/index.html` - 新增UI
- `static/js/index.js` - 新增交互逻辑
- `app.py` - API支持
- `ml_simulator.py` - 核心逻辑

新增的文件：
- `test_custom_profile.py` - 测试脚本
- `MODEL_PROFILE_GUIDE.md` - 详细使用指南

## 限制和未来改进

### 当前限制
- 自定义画像应用于所有选中的模型
- 无法为每个模型单独设置参数

### 计划改进
- [ ] 支持为每个模型单独配置
- [ ] 添加预设模板（保守/平衡/激进）
- [ ] 参数建议系统
- [ ] 可视化参数空间

## 相关文档

- `MODEL_PROFILE_GUIDE.md` - 详细使用指南
- `README_ML_SIMULATOR.md` - 核心框架文档
- `README_WEB.md` - Web应用文档
